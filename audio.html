<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @font-face {
            font-family: 'CoockieRun';
            src: url('coockierun.ttf') format('truetype');
        }

        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }

        #wrapper {
    display: flex;
    justify-content: center;
    align-items: center;

  
    height: auto; /* –í—ã—Å–æ—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ aspect-ratio */
    aspect-ratio: 9 / 16; /* –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω 9:16 */
   
    overflow: hidden;
    border: 1px solid #6f00ff;
}

        #gameContainer {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(138, 138, 138, 0.1);
            position: relative;
            margin: auto;
            width: 90vw; /* –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—É—é –µ–¥–∏–Ω–∏—Ü—É –∏–∑–º–µ—Ä–µ–Ω–∏—è */
            height: auto;
            aspect-ratio: 9 / 16;
            max-width: 400px; 
            max-height: 90vh; /* –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—É—é –µ–¥–∏–Ω–∏—Ü—É –∏–∑–º–µ—Ä–µ–Ω–∏—è */
            border: 1px solid #ff0000;
        }

        #word {
            font-family: 'CoockieRun', sans-serif;
            font-size: 30px; 
            font-weight: normal;
            text-align: center;
            margin: 0;
            color: #616161;
        }

        #startScreen, #gameContainer {
            display: block;
        }

        #startScreen.active, #gameContainer.active {
            display: block;
        }

        #startGameImage {
            width: 50%;
            max-width: 300px;
            transform: translateX(50%);
        }

        button {
            margin: 5px;
            padding: 5px 10px;
            font-size: 20px;
            cursor: pointer;
            background-color: #ffffff;
            color: rgb(51, 51, 51);
            border-radius: 5px;
            transition: all 0.1s ease-in-out;
            border: none;
            box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.2);
        }

        button:active {
           
            box-shadow: 0 1px 8px #b7b7b7;
            transform: translateY(4px);
        }

       

        h1 {
            margin-bottom: 20px;
        }

        #result {
            font-weight: normal;
            font-size: 18px;
            margin: 10px;
        }

        .correct {
                        color: green;
                        font-size: 80px; 
        }

        .incorrect {
                       color: red;
            font-size: 80px; 
        }

        #levelComplete {
            margin-top: 20px;
            font-size: 18px;
            color: rgb(47, 127, 255);
            font-weight: bold;
        }
       
        #resetProgressButton {
    position: absolute; /* –ê–±—Å–æ–ª—é—Ç–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ */
    left: 10px; /* –û—Ç—Å—Ç—É–ø —Å–ª–µ–≤–∞ –≤ 10px –æ—Ç –∫—Ä–∞—è —ç–∫—Ä–∞–Ω–∞ –∏–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
    top: 10px; 
    padding: 10px 20px;
    margin: 5px;
    font-size: 20px;
    background-color: #f44336;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    
}


        #resetProgressButton:hover {
            background-color: #d32f2f;
        }

        .time-out {
            color: red;
            font-weight: bold;
        }

        #stars {
            font-size: 30px;
            position: absolute;
            left: 10px; /* –û—Ç—Å—Ç—É–ø —Å–ª–µ–≤–∞ –≤ 10px –æ—Ç –∫—Ä–∞—è —ç–∫—Ä–∞–Ω–∞ –∏–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
            left: 50%;
            transform: translateX(-50%);
            
        }

        #stars.pulsing {
            animation: pulse 0.3s ease-out;
        }

        @keyframes pulse {
            0% {
                transform: translateX(-50%) scale(1);
                opacity: 1;
            }
            50% {
                transform: translateX(-50%) scale(1.5);
                opacity: 1.5;
            }
            100% {
                transform: translateX(-50%) scale(1);
                opacity: 1;
            }
        }

        #restartButton {
            display: none;
            margin: 10px;
            padding-top: 10px;
            font-size: 16px;
            cursor: pointer;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            box-shadow: 0 4px #b7b7b7;
            transition: all 0.1s ease-in-out;
            text-align: center;
        }

        #restartButton:active {
            background-color: #1976D2;
            box-shadow: 0 2px #b7b7b7;
            transform: translateY(4px);
        }

        

        #continueButton {
            
            
            font-size: 16px;
            cursor: pointer;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            box-shadow: 0 2px 4px #b7b7b7;
            transition: all 0.2s ease-in-out;
            display: none;
        }

        #continueButton:active {
            background-color: #1976D2;
            box-shadow: 0 2px #b7b7b7;
            transform: translateY(4px);
        }

        #continueButton:hover {
            background-color: #1E88E5;
        }

        #phrase {
            font-size: 16px;
            text-align: center;
            margin-bottom: 10px;
        }

        #word {
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            margin: 0;
        }
       #word-container{
        display: block;
        margin-bottom: 10px;
        justify-content: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã */
        align-items: center;
        width: 100%; /* –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */
        height: 300px; 
        border: 1px solid #49ffe1;
       }
       #playSoundButton {
            font-size: 24px;
            padding: 10px 20px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            margin-bottom: 20px;
            margin-right: 10px;
            display: block;
            width: 100%; /* –î–µ–ª–∞–µ–º –∫–Ω–æ–ø–∫—É —à–∏—Ä–æ–∫–æ–π */
        }
    
        #menu-button {
            position: absolute; /* –ê–±—Å–æ–ª—é—Ç–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ */
    right: 20px; /* –û—Ç—Å—Ç—É–ø —Å–ª–µ–≤–∞ –≤ 10px –æ—Ç –∫—Ä–∞—è —ç–∫—Ä–∞–Ω–∞ –∏–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
    top: 10px; /* –û—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É, –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ –∂–µ–ª–∞–Ω–∏—é */
    padding: 10px 20px;
    font-size: 16px;
    margin: 5px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

        #menu-button-container {
            position: absolute;
            bottom: 10px;
            height: 70px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
            display: flex;
            justify-content: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã */
            align-items: center;
            width: 100%; /* –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */
         margin: 5;
         left: 0; /* –ß—Ç–æ–±—ã –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø–æ —à–∏—Ä–∏–Ω–µ */
         right: 0; /* –ß—Ç–æ–±—ã –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø–æ —à–∏—Ä–∏–Ω–µ */
            border: 1px solid #ddd;
        }
        #control-button-container {
          
            height: 70px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
            display: flex;
            justify-content: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã */
            align-items: center;
            width: 100%; /* –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */
            padding-top: 0px;
            padding-right: 0px;
            margin-top: 0px;
            position: relative;
           
            border: 1px solid #00ff11;
        }
      

        #playSoundButton:active {
            background-color: #45a049;
        }
        
    </style>
</head>
<body>
    <div id="wrapper">
        <div id="gameContainer">
            <h1>–£–≥–∞–¥–∞–π –ø–µ—Ä–µ–≤–æ–¥ —Å –∫–æ—Ä–µ–π—Å–∫–æ–≥–æ!</h1>
            <div id="word-container">
                <!-- –ó–∞–º–µ–Ω—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ª–æ–≤–∞ –Ω–∞ –∫–Ω–æ–ø–∫—É –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞ -->
                <button id="playSoundButton" onclick="playWordSound()">üîä –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∑–≤—É–∫</button>
                <!-- –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Å—Ç–∞—é—Ç—Å—è -->
                <button id="option1" onclick="checkWord(this)"></button>
                <button id="option2" onclick="checkWord(this)"></button>
                <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ -->
                <p id="timer">–í—Ä–µ–º—è: <span id="timeLeft">30</span> —Å–µ–∫—É–Ω–¥</p>
                <p id="points">–û—á–∫–∏: 0 / 10</p>
                <p id="level">–£—Ä–æ–≤–µ–Ω—å: 1</p>
            </div>
            <!-- –û—Å—Ç–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ -->
            <div id="control-button-container">
                <p id="result"></p>
                <p id="levelComplete"></p>
                <button id="restartButton" onclick="startGame()" style="display:none;">–ó–∞–Ω–æ–≤–æ</button>
                <button id="continueButton" onclick="startGame()">–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å</button>
            </div>

            <div id="menu-button-container">
                <p id="stars">‚≠ê 0</p>
                <div id="resetProgressButton" onclick="resetProgress()">–°–±—Ä–æ—Å</div>
                <div id="menu-button" onclick="showMenu()">–ú–µ–Ω—é</div>
            </div>
        </div>
    </div>

    <!-- –î–æ–±–∞–≤–ª—è–µ–º –∞—É–¥–∏–æ—ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–æ–≤ —Å–ª–æ–≤ -->
    <audio id="wordAudio" src="" preload="auto"></audio>

    <!-- –ó–≤—É–∫ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∑–≤–µ–∑–¥–æ—á–∫–∏ -->
    <audio id="starSound" src="starsuccess.mp3" preload="auto"></audio>

    <script>
        let wordUsageCount = {};  // –û–±—ä–µ–∫—Ç –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–ª–æ–≤
        let usedWords = [];
        let currentWordIndex = null;  // –ò–Ω–¥–µ–∫—Å —Ç–µ–∫—É—â–µ–≥–æ —Å–ª–æ–≤–∞
        const baseTime = 30;
        let currentLevelWords = [];  // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–ª–æ–≤, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞ —Ç–µ–∫—É—â–µ–º —É—Ä–æ–≤–Ω–µ
        let wordsByLevel = {};


    async function loadWordsByLevel() {
    try {
        const response = await fetch('audiotest.json'); // –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—É—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
        if (!response.ok) {
            throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞: ${response.status} ${response.statusText}`);
        }
        
        wordsByLevel = await response.json(); // –ó–∞–≥—Ä—É–∂–∞–µ–º JSON
        console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', wordsByLevel); // –û—Ç–ª–∞–¥–æ—á–Ω—ã–π –≤—ã–≤–æ–¥
        
        const currentLevelKey = "Lvl1";
        if (!wordsByLevel[currentLevelKey] || wordsByLevel[currentLevelKey].length === 0) {
            console.error(`–ù–µ –Ω–∞–π–¥–µ–Ω–æ —Å–ª–æ–≤ –¥–ª—è —É—Ä–æ–≤–Ω—è: ${currentLevelKey}`);
            return;
        }
        
        console.log('–°–ª–æ–≤–∞ –¥–ª—è —É—Ä–æ–≤–Ω—è Lvl1:', wordsByLevel[currentLevelKey]); // –û—Ç–ª–∞–¥–æ—á–Ω—ã–π –≤—ã–≤–æ–¥

        // –ù–∞—á–∏–Ω–∞–µ–º –∏–≥—Ä—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª–æ–≤
        loadProgress();
        startGame();
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ JSON:', error);
    }
}

 // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–µ–Ω—é (–ø—É—Å—Ç–∞—è –ø–æ–∫–∞ —á—Ç–æ)
 function showMenu() {
        window.location.href = 'index.html'; // –í—Ä–µ–º–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è, —á—Ç–æ –º–µ–Ω—é –æ—Ç–∫—Ä—ã—Ç–æ
    }
    function playWordSound() {
    const wordAudio = document.getElementById("wordAudio");
    wordAudio.play();
}
function saveProgress() {
    localStorage.setItem("audio_level", Game.level);
    localStorage.setItem("audio_points", Game.points);
    localStorage.setItem("audio_correctAnswers", Game.correctAnswers);
    localStorage.setItem("stars", Game.stars);
}

function loadProgress() {
    console.log("–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö");
    Game.level = parseInt(localStorage.getItem("audio_level")) || 1;
    Game.points = parseInt(localStorage.getItem("audio_points")) || 0;
    Game.correctAnswers = parseInt(localStorage.getItem("audio_correctAnswers")) || 0;
    Game.stars = parseInt(localStorage.getItem("stars")) || 0;
    Game.updateUI();
}

const TimerAudio = {
    timeLeft: 30,
    intervalId: null,

    start(level, updateCallback, endCallback) {
        this.timeLeft = Math.max(5, baseTime - (level - 1));  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –≤ 5 —Å–µ–∫—É–Ω–¥
        clearInterval(this.intervalId);
        updateCallback(this.timeLeft); // –°—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è–µ–º UI
        this.intervalId = setInterval(() => {
            this.timeLeft--;
            updateCallback(this.timeLeft);
            if (this.timeLeft <= 0) {
                clearInterval(this.intervalId);
                endCallback();  // –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏, –µ—Å–ª–∏ –≤—Ä–µ–º—è –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å
            }
        }, 1000);
    },

    reset() {
        clearInterval(this.intervalId);
    }
};

const Game = {
    points: 0,
    correctAnswers: 0,
    level: 1,
    stars: 0,

    levelUp() {
    this.level++;
    this.correctAnswers = 0;
    this.points = 0;
    this.stars++;  // –ù–∞—á–∏—Å–ª—è–µ–º –∑–≤–µ–∑–¥–æ—á–∫–∏

    currentLevelWords = [];  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è

    document.getElementById("levelComplete").innerText = `–£—Ä–æ–≤–µ–Ω—å ${this.level - 1}`;
    saveProgress();
    Game.updateUI();  // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ—Å–ª–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –∑–≤–µ–∑–¥–æ—á–µ–∫
    triggerStarPulse();  // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø—É–ª—å—Å–∞—Ü–∏–∏ –∑–≤–µ–∑–¥—ã
    
    TimerAudio.reset();  // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è
    showContinueButton();  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
},

    updateUI() {
        document.getElementById("points").innerText = `–û—á–∫–∏: ${this.points} / 10`;
        document.getElementById("level").innerText = `–£—Ä–æ–≤–µ–Ω—å: ${this.level}`;
        document.getElementById("stars").innerText = `‚≠ê ${this.stars}`; // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–≤–µ–∑–¥–æ—á–µ–∫ —Å —ç–º–æ–¥–∑–∏
        document.getElementById("timeLeft").innerText = TimerAudio.timeLeft;
    }
    
};

function triggerStarPulse() {
    const starsElement = document.getElementById("stars");
    const starSound = document.getElementById("starSound");

    // –£–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å –ø–µ—Ä–µ–¥ –µ–≥–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º, —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏
    starsElement.classList.remove("pulsing");

    // –ó–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã –±—Ä–∞—É–∑–µ—Ä "—É–≤–∏–¥–µ–ª" –∏–∑–º–µ–Ω–µ–Ω–∏–µ
    setTimeout(() => {
        starsElement.classList.add("pulsing");
        starSound.currentTime = 0;  // –°–±—Ä–æ—Å –∑–≤—É–∫–∞ –∫ –Ω–∞—á–∞–ª—É
        starSound.play();           // –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –∑–≤—É–∫–æ–≤–æ–π —ç—Ñ—Ñ–µ–∫—Ç
    }, 20);  // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
}
function startGame() {
    hideContinueButton();  // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å" –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –æ—Ç–≤–µ—Ç–∞
    document.getElementById("levelComplete").innerText = ""; // –û—á–∏—â–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è

    resetUI();
    resetWordUsageCount();

    // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏ —Å–Ω–æ–≤–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–∞—É–Ω–¥–∞
    document.getElementById("option1").disabled = false;
    document.getElementById("option2").disabled = false;

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å –≤ JSON –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è –∏–≥—Ä—ã
    const jsonLevel = Math.floor((Game.level - 1) / 5) + 1;
    const currentLevelKey = `Lvl${jsonLevel}`;

    if (!wordsByLevel[currentLevelKey] || wordsByLevel[currentLevelKey].length === 0) {
        console.error(`–ù–µ –Ω–∞–π–¥–µ–Ω–æ —Å–ª–æ–≤ –¥–ª—è —É—Ä–æ–≤–Ω—è: ${currentLevelKey}`);
        return;
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ª–æ–≤–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
    easywords = wordsByLevel[currentLevelKey];

    if (Game.correctAnswers >= 10) {
        return Game.levelUp();
    }

    setTimeout(() => {
        setRandomWord();  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ª–æ–≤–æ —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
        TimerAudio.start(Game.level, (timeLeft) => {  // –ù–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
            document.getElementById("timeLeft").innerText = timeLeft;
        }, timeRanOut);  // –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏
    }, 150);
}
Game.levelUp = function() {
    this.level++;
    this.correctAnswers = 0;
    this.points = 0;
    this.stars++;  // –ù–∞—á–∏—Å–ª—è–µ–º –∑–≤–µ–∑–¥–æ—á–∫–∏

    currentLevelWords = [];  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è

    document.getElementById("levelComplete").innerText = `–£—Ä–æ–≤–µ–Ω—å ${this.level - 1} –ø—Ä–æ–π–¥–µ–Ω!`;
    saveProgress();
    Game.updateUI();  // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ—Å–ª–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –∑–≤–µ–∑–¥–æ—á–µ–∫
    triggerStarPulse();  // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø—É–ª—å—Å–∞—Ü–∏–∏ –∑–≤–µ–∑–¥—ã

    TimerAudio.reset();  // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è
    showContinueButton();  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
}

function timeRanOut() {
    // –°–±—Ä–æ—Å –æ—á–∫–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
    Game.points = 0;
    Game.correctAnswers = 0;

    // –í—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏
    const resultElement = document.getElementById("result");
    resultElement.innerText = "–í—Ä–µ–º—è –≤—ã—à–ª–æ!\n –ù–∞—á–Ω–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å –∑–∞–Ω–æ–≤–æ.";
    resultElement.className = "time-out"; // –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –∫—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç —á–µ—Ä–µ–∑ –∫–ª–∞—Å—Å

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ"
    document.getElementById("restartButton").style.display = "block";

    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    Game.updateUI();
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Å–ª–æ–≤–∞
function getRandomUnusedWordIndex() {
    if (currentLevelWords.length === easywords.length) {
        currentLevelWords = [];  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–ª–æ–≤–∞ —É—Ä–æ–≤–Ω—è –ø–æ—Å–ª–µ –µ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    }

    let randomIndex;
    let attempts = 0;
    do {
        randomIndex = Math.floor(Math.random() * easywords.length);
        attempts++;
        if (attempts > easywords.length) {  // –ò–∑–±–µ–≥–∞–µ–º –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞, –µ—Å–ª–∏ –≤—Å–µ —Å–ª–æ–≤–∞ –±—ã–ª–∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã
            throw new Error("–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è");
        }
    } while (currentLevelWords.includes(randomIndex) || getUsageCount(randomIndex) >= 5);

    currentLevelWords.push(randomIndex);
    updateUsageCount(randomIndex);  // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–ª–æ–≤–∞

    return randomIndex;
}
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–ª–æ–≤–∞
function getUsageCount(index) {
    return wordUsageCount[index] || 0;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–ª–æ–≤–∞
function updateUsageCount(index) {
    wordUsageCount[index] = (wordUsageCount[index] || 0) + 1;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–ª–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ —Å–±—Ä–æ—Å–µ –∏–≥—Ä—ã)
function resetWordUsageCount() {
    wordUsageCount = {};
}
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Å–ª–æ–≤–∞
function setRandomWord() {
    const randomIndex = getRandomUnusedWordIndex();
    currentLevelWords.push(randomIndex);  // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–≤–æ –≤ –º–∞—Å—Å–∏–≤ —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
    currentWordIndex = randomIndex;  // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –∏–Ω–¥–µ–∫—Å

    const currentWord = easywords[randomIndex];
    const correctOption = Math.random() > 0.5 ? "option1" : "option2";

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
    document.getElementById(correctOption).innerText = currentWord.russian;
    document.getElementById(correctOption === "option1" ? "option2" : "option1").innerText = getRandomIncorrectTranslation(randomIndex);

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Å–ª–æ–≤–∞
    const wordAudio = document.getElementById("wordAudio");
    wordAudio.src = currentWord.audio; // –í JSON-—Ñ–∞–π–ª–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É—Ç—å –∫ –∞—É–¥–∏–æ—Ñ–∞–π–ª—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ–≤–∞

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Å–ª–æ–≤–∞
    playWordSound();
}

function showContinueButton() {
    document.getElementById("option1").style.display = "none";
    document.getElementById("option2").style.display = "none";
    document.getElementById("continueButton").style.display = "inline-block";  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
}

function hideContinueButton() {
    document.getElementById("continueButton").style.display = "none";  // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
    document.getElementById("option1").style.display = "inline-block"; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –æ—Ç–≤–µ—Ç–∞
    document.getElementById("option2").style.display = "inline-block";
}
function checkWord(selectedButton) {
    // –û—Ç–∫–ª—é—á–∞–µ–º –æ–±–µ –∫–Ω–æ–ø–∫–∏, —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞–∂–∞—Ç–∏—è
    document.getElementById("option1").disabled = true;
    document.getElementById("option2").disabled = true;

    const selectedWord = selectedButton.innerText;
    const correctWord = easywords[currentWordIndex].russian;  // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤

    if (selectedWord === correctWord) {
        Game.correctAnswers++;
        Game.points++;
        updateResult("–í–µ—Ä–Ω–æ‚úÖ", "correct");
    } else {
        Game.points = Math.max(Game.points - 1, 0); // –£–º–µ–Ω—å—à–∞–µ–º –æ—á–∫–∏ –Ω–∞ 1, –Ω–µ –¥–æ–ø—É—Å–∫–∞—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
        updateResult("–ù–µ–≤–µ—Ä–Ω–æ‚ùå", "incorrect");
    }

    Game.updateUI();  // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    saveProgress();

    if (Game.points >= 10) {
        setTimeout(() => {
            Game.levelUp(); // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å
        }, 500);
    } else {
        setTimeout(startGame, 500);  // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Å–ª–æ–≤—É
    }
}
function getRandomIncorrectTranslation(correctIndex) {
    let randomIndex;
    do {
        randomIndex = Math.floor(Math.random() * easywords.length);
    } while (randomIndex === correctIndex);
    return easywords[randomIndex].russian;
}
function resetProgress() {
    localStorage.clear();
    Game.points = 0;
    Game.level = 1;
    Game.correctAnswers = 0;
    Game.stars = 0;  // –û–±–Ω—É–ª–µ–Ω–∏–µ –∑–≤–µ–∑–¥–æ—á–µ–∫
    Game.updateUI();  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    startGame();
}

function resetUI() {
    document.getElementById("result").innerText = "";
    document.getElementById("restartButton").style.display = "none";  // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ"
    document.getElementById("option1").disabled = false;
    document.getElementById("option2").disabled = false;
    TimerAudio.timeLeft = baseTime - (Game.level - 1);  // –°–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–∞
}

function updateResult(message, className) {
    const resultElement = document.getElementById("result");
    resultElement.innerText = message;
    resultElement.className = className;

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞
    if (className === "correct") {
        resultElement.style.fontSize = "30px"; // –î–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
    } else if (className === "incorrect") {
        resultElement.style.fontSize = "30px"; // –î–ª—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
    } else {
        resultElement.style.fontSize = "18px"; // –†–∞–∑–º–µ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    }
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ"
document.getElementById("restartButton").onclick = function () {
    document.getElementById("restartButton").style.display = "none";  // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è
    startGame();  // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É
};
 // –¢–µ–ª–µ–≥—Ä–∞–º–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ –æ–∫–Ω–∞
 if (window.Telegram.WebApp) {
            Telegram.WebApp.expand(); // –†–∞—Å—à–∏—Ä—è–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ –ø–æ–ª–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
        }

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
loadWordsByLevel();
loadProgress();
startGame();

</script>
</body>
</html>
